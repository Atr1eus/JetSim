# JettSim

> 基于ue5官方的First Person模板，实现一个游戏demo，具体要求如下：
> 1.demo需实现会移动和攻击玩家的敌人功能，玩家可以击败敌人。
> 2.demo需实现基础的得分和游戏胜利机制，具体玩法可以自由发挥。

实现Valorant中特工Jett的基本技能，游戏模式采用无畏契约靶场中的拆包场景，设计多个位置随机放置会开枪移动的敌人，在限时内完成拆包即可获胜。

设计完整，合适的游戏框架。

[TOC]

## Character(Jett)

特工需要能够使用技能：

| 技能名称 | 触发  | 技能说明                                                     |
| -------- | ----- | ------------------------------------------------------------ |
| 瞬云     | c     | 投掷一个发射物，其在触碰后可扩展成一朵能短暂阻挡视线的云雾。按住技能键能扭曲云雾至准星的方向。 |
| 凌空     | q     | 立即腾空直上，高高跃起。                                     |
| 逐风     | e     | 【激活】即可在限定时间内刮起阵风。【再次使用】该技能可朝移动方向突进。若站立不动，则向面朝的方向突进。 |
| 飓刃     | x     | 装备一组飞刀，按【射击】向目标掷出一把飞刀，击败敌人即可重新充能所有飞刀。按【辅助射击】向你的目标抛掷所有剩余的飞刀，但这样做无法通过击败敌人获得充能。 |
| 飘移     | space | 在坠下的时候按住跳跃键可以让捷风在空中滑翔。                 |

[Jett: Valorant agent abilities overview (+T1 Insights) (mobalytics.gg)](https://mobalytics.gg/valorant/agent/jett/overview)

jett技能的基本参数和逻辑都在这了，连准备时间有多久都有。

角色身体不同部位有不同受击判定（目前不考虑穿墙的伤害削减），分为头身脚。



### 开发流程

决定先实现角色本身的一些技能，至于武器的丢弃和拾取先不考虑，先实现简单的技能。

查找到一个教程：[在虚幻引擎5中复刻瓦罗兰特Jett技能_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1kYtLeCEmF?vd_source=3ec3210bca8d6cc38c6aa90b2f011c3e&spm_id_from=333.788.videopod.sections)

实现了基本的逻辑，于是打算基于此教程进行C++代码的修改和实现。

#### Input输入

由于引擎的改版，现在直接使用增强输入，和以前的输入又不一样了，需要自己创建IA（Input Action）

然后在IMC和character蓝图中绑定，这也意味着我生成自己的BP_Character也可以使用。

*别忘了设计技能期间收起武器*

##### Drift飘移

重新设置了自己的StartJump和StopJump

在这两个MyCharacter函数中调用继承自ACharacter的Jump和StopJumping，并绑定在跳跃触发处。

感觉速度还是太快了？虽然能感受到一定的减速，但是效果不是很明显，log处也又有打印。

后面可以再优化一下。

##### Updraft 凌空

Q触发，简单弄了一个向上的冲量

长短按和空中位移量都还没设置，感觉可以把在空中时的位移进行一定的削减来达成目的

##### Tailwind 逐风

两段E

![null](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20250114221906962.png)

剩一个粘地板的问题尚未解决。同时次数设计也还没有很好的方案，需要后续的补充。



## GameMode

限时，拆包，死亡

### 拆包

设置区域使得只有区域内能够下包，下包后设计**爆能器计时器（20秒），**此外还需要设计游戏计时器（暂定40秒）

### 游戏结束

死亡或者爆能器爆炸都视为游戏结束，游戏结束还关乎UI和level逻辑设计，需要研究一下Level切换以便更改游戏level以及gamemode（但是目前暂定为后续优化目标）

目前只做死亡和计时器结束或者是爆能器爆炸的逻辑，同时加入敌人Bot的死亡逻辑，如果全部死亡则游戏胜利，需要添加胜利widget。

**失败**

- 时间结束如未下包跳出defeatedUI
- 角色被AI击败跳出defeatedUI

**胜利**

- 敌人全被击杀
- 爆能器爆炸

### 具体实现

目前打算单写在gamemode中，因为没有什么特别复杂的逻辑。

## Weapon

设置3种武器，狂徒、鬼魅、小刀，其中狂徒、鬼魅为枪械，能够丢弃拾起，小刀为近战武器，无法拾起。

### 模型

目前打算直接复用源模板代码蓝图，后期再进行模型和动作的更改

### 武器切换

武器切换的逻辑还没思路，需要多加研究才行。

## Enemy

实现了角色的Health接口和组件，但是现在最主要的还是做出UI。

需要添加一个Enemy类并赋予AI操作使其能够测试我的组件是否正常。

### 进度

目前已写完敌人逻辑和模型，现在需要添加动作和控制转向，不能让敌人直接对着角色平移。

- 动作（加入动画并且需要微调，现在敌人的移动范围太大与设计不相符合）
- 血量（加入受击的设定，个人感觉直接调用之前写好的Interface应该就能直接同源使用，把敌人设置为100，角色设置为150）
- 击杀（需要修改子弹的代码，同时和角色的技能联动）

这下动画变得很麻烦了，将预期改为左右移动，只朝角色转向算了。

添加血条和游戏胜利模式。。。

### 动画

动画最开始采用的是直接设置一个速度浮点数然后写一个character类中的函数来调用并更新anim中的speed，但是其需要在tick中反复调用，会增加负担？

为什么重载nativeinitialize和nativeupdate函数后就能直接调用蓝图中的getspeed更新速度并进行检测？

### 武器

添加了敌人武器，简单使用蓝图写了一些逻辑。测试时忘了连接return value导致无法生成。

### 死亡

死亡关连gamemode和UI界面。

## UI

基本UI逻辑已经结束，包括死亡暂停，退出，开始游戏等。

优化方案：开启关闭widget还是单独的函数，个人认为可以进行整合，但尚未实现，且UI之间存在一定的逻辑问题，应该将暂停时的退出给改为回到Menu界面。

### 血条

血条一般做成组件

因为重写beginplay时忘加super导致调试了一下午。当不加super时角色无法移动，只能转动摄像头，不知道什么原理。

### 结束UI

#### victory

界面显示victory字幕和restart、exit按钮

#### defeated

界面显示defeated字幕和restart、exit按钮

### 击杀播报

击杀敌人时显示击杀数和击杀横幅

### 技能UI

技能使用后进入无法使用状态，界面由亮变灰

使用技能逐风时出现提示进度条，击杀两名敌人后刷新进度条

### 游戏状态UI

安装前显示游戏倒计时，安装后爆能器标志

#### 准星

## Spike

### 自身逻辑

起初希望将安装和交互全写在一个AActor子类中，但是在逻辑上出现了不可调和的错误和循环依赖

#### mesh

采用了SKM骨骼构造体，以便播放安装动画。

#### 碰撞

单单设置mesh并不能很好地完成碰撞检测，这会导致无法正确Spwan Actor

于是设置碰撞根组件，这里选择的是box碰撞组件，目的是使其平稳地放在地上。



### 输入

长按数字键”4“进行安装，使用的是**增强输入**（前文制作skill时使用过），写在角色类中，但是并不方便，因为太多逻辑挤在角色类中显得非常的冗杂。之后应该查阅epic官方文档进行对应的修改。

- 新建IA
- 在IMC中指定对应的输入操作
- 在角色类中指定对应的绑定函数

已将输入全部迁移至SpikeInstComponent中。

### 生成

生成spwan一直是心头之患，2月14日简单实现了并不完美的生成

首先是将生成这一步直接剥离成组件
调整了俯仰角和linetrace使其能够正确生成

### `FRotator` 的参数：

1. **Pitch**（俯仰角）：控制物体绕 X 轴的旋转。通常控制物体的上下方向（如物体前后倾斜）。

- **Pitch**：正值表示物体前倾，负值表示物体后仰。

1. **Yaw**（偏航角）：控制物体绕 Z 轴的旋转。通常控制物体的左右方向（如物体的左转或右转）。

- **Yaw**：正值表示物体向右旋转，负值表示物体向左旋转。

1. **Roll**（滚转角）：控制物体绕 Y 轴的旋转。通常控制物体的侧倾，常见于飞机等物体的控制。

- **Roll**：正值表示物体向右倾斜，负值表示物体向左倾斜。

### 安装

将声音播放设置和动画系数绑定在actor上，基本完成，剩下计时器相关的逻辑。
